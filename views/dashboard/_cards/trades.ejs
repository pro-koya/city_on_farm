<section class="card">
  <div class="card__head">
    <h2>取引履歴</h2>
    <a class="link" href="/seller/trades">すべて見る →</a>
  </div>
  <div class="list">
    <% if (trades && trades.length) { %>
      <% trades.forEach(function(t){
        const isPickup = t.ship_method === 'pickup';
        const statusText = t.status || '';

        // ステータスバッジクラスを決定
        let badgeClass = 'status-badge--processing';
        if (/完了|配達完了|支払い済み/.test(statusText)) {
          badgeClass = 'status-badge--delivered';
        } else if (/キャンセル/.test(statusText)) {
          badgeClass = 'status-badge--cancelled';
        } else if (/返金/.test(statusText)) {
          badgeClass = 'status-badge--refunded';
        }

        // 日時表示
        const etaText = t.eta || '日付指定なし';
        const timeText = t.shipTimeJa || '';
      %>
        <a href="/seller/trades/<%= t.id %>" class="trade-item">
          <div class="trade-item__row">
            <span class="status-badge <%= badgeClass %>"><%= statusText %></span>
            <span class="order-item__amount">¥<%= Number(t.amount||0).toLocaleString() %></span>
            <span class="trade-item__buyer"><%= t.buyer_name %></span>
          </div>
          <div class="trade-item__row">
            <span class="trade-item__detail">
              <span class="method-badge <%= isPickup ? 'method-badge--pickup' : 'method-badge--delivery' %>">
                <%= isPickup ? '畑受取' : '配送' %>
              </span>
            </span>
            <span class="trade-item__detail">
              <%= isPickup ? '受取' : '配送' %>: <%= etaText %><% if (timeText) { %> <%= timeText %><% } %>
            </span>
          </div>
        </a>
      <% }) %>
    <% } else { %>
      <p class="empty">まだ取引がありません。</p>
    <% } %>
  </div>
</section>