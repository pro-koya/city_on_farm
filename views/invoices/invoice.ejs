<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>領収書 <%= order.orderNo %></title>
  <% if (typeof baseUrl !== 'undefined' && baseUrl) { %>
    <base href="<%= baseUrl %>">
    <% } %>
  <link rel="stylesheet" href="/styles/invoice.css">
</head>
<body>
<div class="page">

  <div class="doc-head">
    <div class="brand">
      <!-- サイトのロゴがあれば img を置き換えてください -->
      <span class="logo" aria-hidden="true"></span>
      <div>
        <div class="title">新・今日の食卓</div>
        <div class="muted" style="font-size:12px;">公式ストア</div>
      </div>
    </div>
    <div class="doc-meta">
      <h1>領収書</h1>
      <div>注文番号：<strong><%= order.orderNo %></strong></div>
      <div>発行日：<%= new Date(order.createdAt).toLocaleDateString('ja-JP') %></div>
      <div>支払方法：<%= order.paymentMethod || '—' %> <span class="badge"><%= order.paymentStatus || '' %></span></div>
    </div>
  </div>

  <div class="meta-grid">
    <div class="card">
      <h3>購入者</h3>
      <div class="buyer-lines">
        <% if (buyer.name) { %><div><%= buyer.name %> 様</div><% } %>
        <% if (buyer.email) { %><div class="muted"><%= buyer.email %></div><% } %>
      </div>
    </div>
    <div class="card">
      <h3>請求先住所</h3>
      <div class="addr-lines">
        <% if (billingAddress && billingAddress.lines && billingAddress.lines.length) { %>
          <% billingAddress.lines.forEach(function(l){ %><div><%= l %></div><% }) %>
        <% } else { %>
          <div class="muted">未設定</div>
        <% } %>
      </div>
    </div>
    <div class="card">
      <h3>注文情報</h3>
      <div class="addr-lines">
        <div>注文日時：<%= new Date(order.createdAt).toLocaleString('ja-JP') %></div>
        <div>ステータス：<%= order.status %></div>
      </div>
    </div>
    <div class="card">
      <h3>配送先住所</h3>
      <div class="addr-lines">
        <% if (shippingAddress && shippingAddress.lines && shippingAddress.lines.length) { %>
          <% shippingAddress.lines.forEach(function(l){ %><div><%= l %></div><% }) %>
        <% } else { %>
          <div class="muted">未設定</div>
        <% } %>
      </div>
    </div>
  </div>

  <% const yen = (n)=>'¥' + Number(n||0).toLocaleString('ja-JP'); %>
  <div class="summary">
    <div><!-- 余白（注意書きなどに利用可） --></div>
    <div class="sum-card">
      <div class="sum-row"><div>小計</div><div class="num"><%= yen(summary.subtotal) %></div></div>
      <div class="sum-row"><div>値引</div><div class="num">- <%= yen(summary.discount) %></div></div>
      <div class="sum-row"><div>送料</div><div class="num"><%= yen(summary.shippingFee) %></div></div>
      <div class="sum-row"><div>消費税</div><div class="num"><%= yen(summary.tax) %></div></div>
      <div class="sum-row total"><div>合計</div><div class="num"><%= yen(summary.total) %></div></div>
    </div>
  </div>

  <table aria-label="明細">
    <thead>
      <tr>
        <th style="width:52%;">商品名</th>
        <th style="width:12%;">数量</th>
        <th style="width:18%;">単価</th>
        <th style="width:18%;">金額</th>
      </tr>
    </thead>
    <tbody>
      <% if (items && items.length) { %>
        <% items.forEach(function(it){ %>
          <tr>
            <td>
              <div><strong><%= it.name %></strong></div>
              <% if (it.unit) { %><div class="muted" style="font-size:12px;">単位：<%= it.unit %></div><% } %>
            </td>
            <td class="num"><%= it.quantity %></td>
            <td class="num"><%= yen(it.unitPrice) %></td>
            <td class="num"><%= yen(it.lineTotal) %></td>
          </tr>
        <% }); %>
      <% } else { %>
        <tr><td colspan="4" class="muted">明細がありません。</td></tr>
      <% } %>
    </tbody>
  </table>

  <p class="foot-note">
    この領収書は「新・今日の食卓」でのご注文に基づき自動発行されています。<br/>
    会社名の記載や但し書きなど特別な記載が必要な場合は、サポートまでご連絡ください。
  </p>

</div>
</body>
</html>