<div class="modal" id="addressModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal__content" role="document">
    <div class="modal__head">
      <h3 id="addrModalTitle">住所</h3>
      <button type="button" class="icon-btn" id="closeAddressModal" aria-label="閉じる">✕</button>
    </div>
    <form id="addressForm" class="h-adr" novalidate>
      <% if (csrfToken) { %><input type="hidden" name="_csrf" value="<%= csrfToken %>"><% } %>
      <input type="hidden" id="addr_id" name="id" value="">
      <input type="hidden" id="addr_type" name="address_type" value="shipping">
      
      <span class="p-country-name" style="display: none;">Japan</span>

      <div class="grid2">
        <div class="field">
          <label for="addr_full_name">氏名 *</label>
          <input id="addr_full_name" name="full_name" type="text" required>
        </div>
        <div class="field">
          <label for="addr_phone">電話番号 *</label>
          <input id="addr_phone" name="phone" type="tel" required>
        </div>
      </div>

      <div class="grid3">
        <div class="field">
          <label for="addr_postal">郵便番号 *</label>
          <input id="addr_postal" name="postal_code" type="text" class="p-postal-code" required placeholder="例）1000001">
        </div>
        <div class="field">
          <label for="addr_pref">都道府県 *</label>
          <input id="addr_pref" name="prefecture" type="text" required class="p-region" readonly>
        </div>
        <div class="field">
          <label for="addr_city">市区町村 *</label>
          <input id="addr_city" name="city" type="text" required class="p-locality" readonly>
        </div>
      </div>

      <div class="field">
        <label for="addr_line1">番地・丁目 *</label>
        <input id="addr_line1" name="address_line1" type="text" required class="p-street-address">
      </div>
      <div class="field">
        <label for="addr_line2">建物名・部屋番号（任意）</label>
        <input id="addr_line2" name="address_line2" type="text" class="p-extended-address">
      </div>

      <label class="check">
        <input type="checkbox" id="addr_default" name="is_default" value="1"> 既定の住所に設定する
      </label>

      <div class="modal__foot">
        <button type="button" class="btn btn--ghost" id="cancelAddress">キャンセル</button>
        <button type="submit" class="btn btn--primary" id="saveAddress">保存</button>
      </div>
      <p class="error" id="addrError" aria-live="polite"></p>
    </form>

    <div class="modal__divider"></div>

    <!-- 一覧（「すべての住所を見る」から開いたときに使う） -->
    <div id="allAddrWrap" hidden>
      <h4>登録済みの住所</h4>
      <ul class="addr-list" id="allAddrList"></ul>
    </div>
  </div>
</div>