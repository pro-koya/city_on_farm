<%- include('../partials/header', { title: 'サインアップ', extraCSS: '/styles/signup.css' }) %>

<main class="auth">
  <section class="card">
    <div class="auth-card__header">
      <h1>アカウント作成</h1>
      <p class="lead">1分で登録完了。すぐにお買い物を始められます。</p>
    </div>

    <form id="signup-form" class="auth-form" method="POST" action="/signup" novalidate>
      <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <% } %>

      <!-- 名前 -->
      <div class="field">
        <label for="name">お名前 *</label>
        <input id="name" name="name" type="text" maxlength="60"
               placeholder="例）山田 太郎" required
               value="<%= (values && values.name) ? values.name : '' %>">
        <p class="error" data-for="name"><%= (fieldErrors && fieldErrors.name) ? fieldErrors.name : '' %></p>
      </div>

      <!-- メール -->
      <div class="field">
        <label for="email">メールアドレス *</label>
        <input id="email" name="email" type="email"
               placeholder="you@example.com" autocomplete="email" required
               value="<%= (values && values.email) ? values.email : '' %>">
        <p class="error" data-for="email"><%= (fieldErrors && fieldErrors.email) ? fieldErrors.email : '' %></p>
      </div>

      <!-- パスワード -->
      <div class="field">
        <div class="label-row">
          <label for="password">パスワード *</label>
          <button type="button" class="link tiny" id="togglePw">表示</button>
        </div>
        <input id="password" name="password" type="password"
               placeholder="8文字以上・英数字混在を推奨" autocomplete="new-password" required>
        <div class="pw-meter" id="pwMeter" aria-live="polite" aria-hidden="true">
          <div class="pw-meter__track" role="progressbar"
              aria-valuemin="0" aria-valuemax="4" aria-valuenow="0" aria-label="パスワード強度">
            <div class="pw-meter__bar" id="pwBar"></div>
          </div>
          <span class="pw-meter__label" id="pwLabel">強度: -</span>
        </div>
        <p class="hint">安全のため、8文字以上で推奨は英大文字・小文字・数字・記号の組み合わせです。</p>
        <p class="error" data-for="password"><%= (fieldErrors && fieldErrors.password) ? fieldErrors.password : '' %></p>
      </div>

      <!-- 確認 -->
      <div class="field">
        <label for="passwordConfirm">パスワード（確認） *</label>
        <input id="passwordConfirm" name="passwordConfirm" type="password"
               placeholder="もう一度入力" autocomplete="new-password" required>
        <p class="error" data-for="passwordConfirm"><%= (fieldErrors && fieldErrors.passwordConfirm) ? fieldErrors.passwordConfirm : '' %></p>
      </div>

      <!-- ロールの希望 -->
      <!-- <div class="field">
        <label class="check">
          <input type="hidden" name="wantSeller" value="0">
          <input type="checkbox" name="wantSeller" value="1"
                 <%= (values && values.wantSeller) ? 'checked' : '' %>>
          出品も行いたい（出品者権限の申請）
        </label>
        <p class="hint">申請後、審査・承認により「出品者」の機能が有効になります。</p>
      </div> -->

      <!-- 新規パートナー登録 -->
      <div id="partnerNewWrap" class="field">
        <label for="partnerName">取引先名（新規） *</label>
        <input id="partnerName" name="partnerName" type="text" maxlength="120"
              placeholder="例）やまなか食堂"
              value="<%= values?.partnerName || '' %>">
        <div class="grid2">
          <div>
            <label for="partnerType">種別</label>
            <select class="pulldown" id="partnerType" name="partnerType">
              <option value="">-- 任意 --</option>
              <option value="restaurant" <%= (values?.partnerType==='restaurant')?'selected':'' %>>飲食店</option>
              <option value="retailer"   <%= (values?.partnerType==='retailer')?'selected':'' %>>小売</option>
              <option value="wholesale"  <%= (values?.partnerType==='wholesale')?'selected':'' %>>卸</option>
              <option value="other"      <%= (values?.partnerType==='other')?'selected':'' %>>その他</option>
            </select>
          </div>
          <div>
            <label for="partnerPhone">電話番号</label>
            <input id="partnerPhone" name="partnerPhone" type="tel" maxlength="30"
                  placeholder="03-xxxx-xxxx" value="<%= values?.partnerPhone || '' %>">
          </div>
        </div>
        <!-- 住所（新規パートナー用・分割） -->
        <div class="grid2">
          <div>
            <label for="partnerPostal">郵便番号　<small class="muted">ハイフンあり/なし可</small></label>
            <div class="inline">
              <input id="partnerPostal" name="partnerPostal" type="text" inputmode="numeric"
                    placeholder="例）1000001 または 100-0001"
                    maxlength="8"
                    value="<%= values?.partnerPostal || '' %>">
            </div>
            <p class="error" data-for="partnerPostal"><%= fieldErrors?.partnerPostal || '' %></p>
          </div>
          <div>
            <label for="partnerPrefecture">都道府県</label>
            <select class="pulldown" id="partnerPrefecture" name="partnerPrefecture">
              <option value="">-- 選択 --</option>
              <% const prefs = [
                '北海道','青森県','岩手県','宮城県','秋田県','山形県','福島県',
                '茨城県','栃木県','群馬県','埼玉県','千葉県','東京都','神奈川県',
                '新潟県','富山県','石川県','福井県','山梨県','長野県',
                '岐阜県','静岡県','愛知県','三重県',
                '滋賀県','京都府','大阪府','兵庫県','奈良県','和歌山県',
                '鳥取県','島根県','岡山県','広島県','山口県',
                '徳島県','香川県','愛媛県','高知県',
                '福岡県','佐賀県','長崎県','熊本県','大分県','宮崎県','鹿児島県','沖縄県'
              ]; %>
              <% prefs.forEach(p => { %>
                <option value="<%= p %>" <%= (values?.partnerPrefecture===p)?'selected':'' %>><%= p %></option>
              <% }) %>
            </select>
            <p class="error" data-for="partnerPrefecture"><%= fieldErrors?.partnerPrefecture || '' %></p>
          </div>
        </div>

        <div class="field">
          <label for="partnerCity">市区町村</label>
          <input id="partnerCity" name="partnerCity" type="text" maxlength="120"
                placeholder="例）千代田区丸の内" value="<%= values?.partnerCity || '' %>">
          <p class="error" data-for="partnerCity"><%= fieldErrors?.partnerCity || '' %></p>
        </div>

        <div class="field">
          <label for="partnerAddress1">番地</label>
          <input id="partnerAddress1" name="partnerAddress1" type="text" maxlength="160"
                placeholder="例）1-1-1" value="<%= values?.partnerAddress1 || '' %>">
          <p class="error" data-for="partnerAddress1"><%= fieldErrors?.partnerAddress1 || '' %></p>
        </div>

        <div class="field">
          <label for="partnerAddress2">建物名・部屋番号（任意）</label>
          <input id="partnerAddress2" name="partnerAddress2" type="text" maxlength="160"
                placeholder="例）〇〇ビル 3F" value="<%= values?.partnerAddress2 || '' %>">
          <p class="error" data-for="partnerAddress2"><%= fieldErrors?.partnerAddress2 || '' %></p>
        </div>
      </div>

      <!-- 規約 -->
      <div class="field">
        <label class="check">
          <!-- <input type="hidden" name="agree" value="0"> -->
          <input type="checkbox" id="agree" name="agree" value="1"
                 <%= (values && values.agree) ? 'checked' : '' %> required>
          <a href="/terms" target="_blank" class="link" rel="noopener">利用規約</a>・
          <a href="/privacy" target="_blank" class="link" rel="noopener">プライバシーポリシー</a>に同意します *
        </label>
        <p class="error" data-for="agree"><%= (fieldErrors && fieldErrors.agree) ? fieldErrors.agree : '' %></p>
      </div>

      <!-- 送信 -->
      <div class="actions">
        <button class="btn" type="submit" id="signupBtn" disabled>登録</button>
      </div>

      <!-- 全体エラー -->
      <% if (globalError) { %>
        <div class="global-error" role="alert"><%= globalError %></div>
      <% } %>
    </form>

    <div class="auth-card__footer">
      <p>すでにアカウントをお持ちですか？ <a href="/login" class="link">ログイン</a></p>
    </div>
  </section>
</main>

<script src="/js/auth-signup.js"></script>
<%- include('../partials/footer') %>