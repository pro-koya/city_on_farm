<%- include('../partials/header', { title: 'サインアップ', extraCSS: '/styles/signup.css' }) %>

<main class="auth">
  <section class="auth-card">
    <div class="auth-card__header">
      <h1>アカウント作成</h1>
      <p class="lead">1分で登録完了。すぐにお買い物を始められます。</p>
    </div>

    <form id="signup-form" class="auth-form" method="POST" action="/signup" novalidate>
      <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <% } %>

      <!-- 名前 -->
      <div class="field">
        <label for="name">お名前 *</label>
        <input id="name" name="name" type="text" maxlength="60"
               placeholder="例）山田 太郎" required
               value="<%= (values && values.name) ? values.name : '' %>">
        <p class="error" data-for="name"><%= (fieldErrors && fieldErrors.name) ? fieldErrors.name : '' %></p>
      </div>

      <!-- メール -->
      <div class="field">
        <label for="email">メールアドレス *</label>
        <input id="email" name="email" type="email"
               placeholder="you@example.com" autocomplete="email" required
               value="<%= (values && values.email) ? values.email : '' %>">
        <p class="error" data-for="email"><%= (fieldErrors && fieldErrors.email) ? fieldErrors.email : '' %></p>
      </div>

      <!-- パスワード -->
      <div class="field">
        <div class="label-row">
          <label for="password">パスワード *</label>
          <button type="button" class="link tiny" id="togglePw">表示</button>
        </div>
        <input id="password" name="password" type="password"
               placeholder="8文字以上・英数字混在を推奨" autocomplete="new-password" required>
        <div class="pw-meter" id="pwMeter" aria-live="polite" aria-hidden="true">
          <div class="pw-meter__track" role="progressbar"
              aria-valuemin="0" aria-valuemax="4" aria-valuenow="0" aria-label="パスワード強度">
            <div class="pw-meter__bar" id="pwBar"></div>
          </div>
          <span class="pw-meter__label" id="pwLabel">強度: -</span>
        </div>
        <p class="hint">安全のため、8文字以上で推奨は英大文字・小文字・数字・記号の組み合わせです。</p>
        <p class="error" data-for="password"><%= (fieldErrors && fieldErrors.password) ? fieldErrors.password : '' %></p>
      </div>

      <!-- 確認 -->
      <div class="field">
        <label for="passwordConfirm">パスワード（確認） *</label>
        <input id="passwordConfirm" name="passwordConfirm" type="password"
               placeholder="もう一度入力" autocomplete="new-password" required>
        <p class="error" data-for="passwordConfirm"><%= (fieldErrors && fieldErrors.passwordConfirm) ? fieldErrors.passwordConfirm : '' %></p>
      </div>

      <!-- ロールの希望 -->
      <div class="field">
        <label class="check">
          <input type="hidden" name="wantSeller" value="0">
          <input type="checkbox" name="wantSeller" value="1"
                 <%= (values && values.wantSeller) ? 'checked' : '' %>>
          出品も行いたい（出品者権限の申請）
        </label>
        <p class="hint">申請後、審査・承認により「出品者」の機能が有効になります。</p>
      </div>

      <!-- 規約 -->
      <div class="field">
        <label class="check">
          <!-- <input type="hidden" name="agree" value="0"> -->
          <input type="checkbox" id="agree" name="agree" value="1"
                 <%= (values && values.agree) ? 'checked' : '' %> required>
          <a href="/terms" target="_blank" class="link" rel="noopener">利用規約</a>・
          <a href="/privacy" target="_blank" class="link" rel="noopener">プライバシーポリシー</a>に同意します *
        </label>
        <p class="error" data-for="agree"><%= (fieldErrors && fieldErrors.agree) ? fieldErrors.agree : '' %></p>
      </div>

      <!-- 送信 -->
      <div class="actions">
        <button class="btn" type="submit" id="signupBtn" disabled>登録</button>
      </div>

      <!-- 全体エラー -->
      <% if (globalError) { %>
        <div class="global-error" role="alert"><%= globalError %></div>
      <% } %>
    </form>

    <div class="auth-card__footer">
      <p>すでにアカウントをお持ちですか？ <a href="/login" class="link">ログイン</a></p>
    </div>
  </section>
</main>

<script src="/js/auth-signup.js"></script>
<%- include('../partials/footer') %>