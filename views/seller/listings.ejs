<%- include('../partials/header', { title: 'Âá∫ÂìÅÁÆ°ÁêÜ' , extraCSS: '/styles/seller-listings.css' }) %>

  <main class="seller-list">
    <form id="filters" class="toolbar" method="GET" action="/seller/listings">
      <div class="toolbar__left">
        <h1>Âá∫ÂìÅÁÆ°ÁêÜ</h1>
        <p class="muted">
          <%= total || 0 %> ‰ª∂
        </p>
      </div>

      <div class="toolbar__right">
        <div class="search">
          <input type="search" name="q" value="<%= q || '' %>" placeholder="ÂïÜÂìÅÂêç„ÉªË™¨Êòé„ÅßÊ§úÁ¥¢" aria-label="Ê§úÁ¥¢">
        </div>

        <select name="status" class="pulldown" aria-label="ÂÖ¨ÈñãÁä∂ÊÖã">
          <option value="all" <%=(status||'all')==='all' ?'selected':'' %>>„Åô„Åπ„Å¶</option>
          <option value="public" <%=status==='public' ?'selected':'' %>>ÂÖ¨Èñã</option>
          <option value="private" <%=status==='private' ?'selected':'' %>>ÈôêÂÆöÂÖ¨Èñã</option>
          <option value="draft" <%=status==='draft' ?'selected':'' %>>‰∏ãÊõ∏„Åç</option>
        </select>

        <select name="sort" class="pulldown" aria-label="‰∏¶„Å≥È†Ü">
          <option value="updated" <%=(sort||'updated')==='updated' ?'selected':'' %>>Êõ¥Êñ∞„ÅåÊñ∞„Åó„ÅÑ</option>
          <option value="stockAsc" <%=sort==='stockAsc' ?'selected':'' %>>Âú®Â∫´„ÅåÂ∞ë„Å™„ÅÑÈ†Ü</option>
          <option value="priceAsc" <%=sort==='priceAsc' ?'selected':'' %>>‰æ°Ê†º„ÅÆÂÆâ„ÅÑÈ†Ü</option>
          <option value="priceDesc" <%=sort==='priceDesc' ?'selected':'' %>>‰æ°Ê†º„ÅÆÈ´ò„ÅÑÈ†Ü</option>
        </select>

        <div class="search">
          <button class="btn" type="submit" aria-label="Ê§úÁ¥¢">Ê§úÁ¥¢</button>
        </div>

        <a class="btn btn--ghost" href="/seller/listing-new">Ôºã Êñ∞Ë¶èÂá∫ÂìÅ</a>
      </div>
    </form>

    <% if (!listings || !listings.length) { %>
      <section class="empty">
        <div class="empty__icon" aria-hidden="true">üì¶</div>
        <h2>„Åæ„Å†Âá∫ÂìÅ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h2>
        <p class="muted">„Åæ„Åö„ÅØÊúÄÂàù„ÅÆÂá∫ÂìÅ„Çí‰ΩúÊàê„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
        <a class="btn" href="/seller/listing-new">Êñ∞Ë¶èÂá∫ÂìÅ</a>
      </section>
      <% } else { %>

        <!-- „Éê„É´„ÇØÊìç‰Ωú -->
        <form id="bulkForm" class="bulk" method="POST" action="/seller/listings/bulk">
          <% if (typeof csrfToken !=='undefined' && csrfToken) { %>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <% } %>
              <div class="bulk__left">
                <th class="col-check">
                  <label class="chk">
                    <input type="checkbox" id="selectAll" aria-label="„Åô„Åπ„Å¶ÈÅ∏Êäû">
                  </label>
                </th>

                <div class="count-block">

                </div>

                <select name="bulkAction" class="pulldown" id="bulkAction" aria-label="‰∏ÄÊã¨Êìç‰Ωú">
                  <option value="">‰∏ÄÊã¨Êìç‰Ωú</option>
                  <option value="publish">ÂÖ¨Èñã„Å´„Åô„Çã</option>
                  <option value="privatize">ÈôêÂÆöÂÖ¨Èñã„Å´„Åô„Çã</option>
                  <option value="draft">‰∏ãÊõ∏„Åç„Å´„Åô„Çã</option>
                  <option value="delete">ÂâäÈô§</option>
                </select>
                <button class="btn btn--ghost" type="button" id="applyBulk" disabled>ÈÅ©Áî®</button>

                <% if (pagination) { %>
                  <nav class="pager" aria-label="„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥">
                    <% for (let p=1; p<=pagination.pageCount; p++){ %>
                      <a class="pager__link <%= p===pagination.page?'is-active':'' %>"
                        href="<%= buildQuery ? buildQuery({page:p}) : ('?page='+p) %>">
                        <%= p %>
                      </a>
                      <% } %>
                  </nav>
                  <% } %>
              </div>


              <!-- „ÉÜ„Éº„Éñ„É´ÔºàPCÔºâ -->
              <div class="table-wrap">
                <table class="table" aria-describedby="tableCaption">
                  <caption id="tableCaption" class="sr-only">Âá∫ÂìÅ„É™„Çπ„Éà</caption>
                  <thead>
                    <tr>
                      <th scope="col" class="col-check"></th>
                      <th scope="col">ÂïÜÂìÅ</th>
                      <th scope="col">‰æ°Ê†º</th>
                      <th scope="col">Âú®Â∫´</th>
                      <th scope="col">Áä∂ÊÖã</th>
                      <th scope="col">Êõ¥Êñ∞</th>
                      <th scope="col" class="col-actions">Êìç‰Ωú</th>
                    </tr>
                  </thead>
                  <tbody id="listingBody">
                    <% listings.forEach(function(it){ %>
                      <tr class="row" data-id="<%= it.id %>">
                        <td class="col-check">
                          <label class="chk">
                            <input type="checkbox" class="rowCheck" value="<%= it.id %>" aria-label="Ë°å„ÇíÈÅ∏Êäû">
                          </label>
                        </td>
                        <td class="col-main">
                          <a class="thumb" href="/products/<%= it.slug %>" target="_blank" rel="noopener">
                            <img src="<%= it.image_url || '/images/placeholder.png' %>" alt="" loading="lazy">
                          </a>
                          <div class="meta">
                            <a class="title" href="/products/<%= it.slug %>" target="_blank" rel="noopener">
                              <%= it.title %>
                            </a>
                            <div class="badges">
                              <% if (it.is_organic){ %><span class="badge is-green">ÊúâÊ©ü</span>
                                <% } %>
                                  <% if (it.is_seasonal){ %><span class="badge">Êó¨</span>
                                    <% } %>
                            </div>
                          </div>
                        </td>
                        <td class="col-price">¬•<%= Number(it.price||0).toLocaleString() %>
                        </td>
                        <td class="col-stock">
                          <span class="<%= (it.stock||0)<=0 ? 'danger' : (it.stock<=10 ? 'warn' : '') %>">
                            <%= it.stock %>
                          </span>
                        </td>
                        <td class="col-status">
                          <span class="status status--<%= it.status %>">
                            <%= it.status %>
                          </span>
                        </td>
                        <td class="col-updated">
                          <%= (it.updated_at ? new Date(it.updated_at).toLocaleString('ja-JP') : '-' ) %>
                        </td>
                        <td class="col-actions">
                          <div class="actions">
                            <a class="icon-btn" href="/seller/listing-edit/<%= it.id %>" title="Á∑®ÈõÜ">Á∑®ÈõÜ</a>
                            <button type="button" class="icon-btn js-quick-toggle" data-id="<%= it.id %>"
                              data-next="<%= it.status==='public'?'private':'public' %>" title="ÂÖ¨ÈñãÁä∂ÊÖã„ÇíÂàáÊõø">
                              <%= it.status==='public' ? 'ÈùûÂÖ¨Èñã' : 'ÂÖ¨Èñã' %>
                            </button>
                            <button type="button" class="icon-btn danger js-delete" data-id="<%= it.id %>"
                              title="ÂâäÈô§">ÂâäÈô§</button>
                          </div>
                        </td>
                      </tr>
                      <% }) %>
                  </tbody>
                </table>
              </div>

              <!-- „Ç´„Éº„ÉâÔºà„É¢„Éê„Ç§„É´Ôºâ -->
              <ul class="cards" id="listingCards">
                <% listings.forEach(function(it){ %>
                  <li class="card" data-id="<%= it.id %>">
                    <ul class="card-grid">
                      <div class="card__check">
                        <label class="chk chk--sm">
                          <input type="checkbox" class="rowCheck" value="<%= it.id %>" aria-label="„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû">
                        </label>
                      </div>
                      <a class="card__thumb" href="/products/<%= it.slug %>" target="_blank" rel="noopener">
                        <img src="<%= it.image_url || '/images/placeholder.png' %>" alt="">
                      </a>
                      <div class="card__main">
                        <a class="card__title" href="/products/<%= it.slug %>" target="_blank" rel="noopener">
                          <%= it.title %>
                        </a>
                        <div class="badges">
                          <% if (it.is_organic){ %><span class="badge is-green">ÊúâÊ©ü</span>
                            <% } %>
                              <% if (it.is_seasonal){ %><span class="badge">Êó¨</span>
                                <% } %>
                        </div>
                        <div class="row">
                          <span>‰æ°Ê†º</span><strong>¬•<%= Number(it.price||0).toLocaleString() %></strong>
                        </div>
                        <div class="row">
                          <span>Âú®Â∫´</span>
                          <strong class="<%= (it.stock||0)<=0 ? 'danger' : (it.stock<=10 ? 'warn' : '') %>">
                            <%= it.stock %>
                          </strong>
                        </div>
                        <div class="row">
                          <span>Áä∂ÊÖã</span>
                          <span class="status status--<%= it.status %>">
                            <%= it.status %>
                          </span>
                        </div>
                      </div>
                    </ul>
                    <div class="actions">
                      <a class="btn btn--ghost" href="/seller/listing-edit/<%= it.id %>">Á∑®ÈõÜ</a>
                      <button type="button" class="btn js-quick-toggle" data-id="<%= it.id %>"
                        data-next="<%= it.status==='public'?'private':'public' %>">
                        <%= it.status==='public' ? 'ÈôêÂÆöÂÖ¨Èñã„Å´' : 'ÂÖ¨Èñã„Å´' %>
                      </button>
                      <button type="button" class="btn danger js-delete" data-id="<%= it.id %>">ÂâäÈô§</button>
                    </div>
                  </li>
                  <% }) %>
              </ul>

        </form>
        <% } %>
  </main>

  <script src="/js/seller-listings.js"></script>
  <%- include('../partials/footer') %>